from evolution.individual import Individual
from evolution.nca_individual import NCAIndividual
from graph.graph_generator import GraphGenerator
from network.network_generator import NetworkGenerator
from evolution.individual_generator import IndividualGenerator
from config import config_reader
import torch
from evolution.fitness import Fitness

evo_config, ind_config, graph_config, neat_config = config_reader.read_config("config.json")

network_generator = NetworkGenerator()
network_generator.set_parameters(**neat_config)
graph_generator = GraphGenerator()
graph_generator.set_parameters(**graph_config)
individual_generator = IndividualGenerator(graph_generator, network_generator)
individual_generator.set_parameters(**ind_config)

#baseline_pendulum_bests = [-205.21968447681692, -151.5020545424613, -350.07199260825064, -76.26483663573012, -430.33347990483963, -392.12764128953575, -188.6076554377267, -448.75265347573315, -473.24168005640576, -97.65601556831345, -398.15024707071154, -421.3863033857514, -151.34130480840116, -492.6899425894544, -432.18500410929437, -461.02720694624566, -394.5835226709353, -356.4226292592505, -434.8902673409116, -223.34824101472842, -141.5642283424589, -451.1988529025874, -408.0775645520005, -125.22671074141576, -304.28212957275133]
#baseline_pendulum_averages = [-524.5446688287633, -280.30592527704357, -554.1922020932519, -244.13714260148146, -575.3605892913824, -610.59440629132, -470.6400776534625, -587.6973051335822, -612.0470339277135, -179.49774112894468, -576.1033798961967, -602.1800531687059, -228.55552495548721, -655.4987880718968, -611.1482038309023, -629.6365883182234, -572.3112439091142, -599.0024998833558, -609.5025474801378, -566.1467372933978, -319.1983832778314, -602.014921804512, -606.9642164524487, -242.7661804234434, -582.8829100383684]

#pendulum_penalty_bests = [-157.19410963142826, -103.49978986946144, -673.7131871585198, -670.4059387313222, -193.98834866967556, -189.96933819248906, -674.182446714176, -412.87189572971164, -432.49482619282753, -499.0325910438276, -110.47630913216847, -701.688688224908, -102.74567233309524, -162.74309117466277, -644.8336748726272, -463.82494208060507, -507.65100553651047, -667.5953712484036, -476.8146620267141, -495.3070368210191, -107.92853828849772, -80.11722207627813, -637.1627959910587, -439.59028441984674, -351.7511280596392]
#pendulum_penalty_averages = [-322.2757538851303, -308.5850551138674, -719.277848287714, -703.3777730950743, -451.6233464829194, -315.4603277608396, -727.2904163423623, -640.4311084312252, -622.8606482918872, -702.6083635342918, -155.96023896481154, -740.5335681179185, -209.75612325025585, -464.69276660679105, -704.5717620154785, -663.8732051900452, -757.0684719050303, -695.4411236220618, -640.294316423699, -659.7270548612146, -160.70364465485355, -159.26214126875158, -683.8184290075449, -610.1126858220705, -683.4173988834916]

#individual = individual_generator.get_individual()
#NCA = torch.load("AI/Bipedal/BipedalWalker-v3_98528_168.2308048503489_1650010138.9071965")
#individual = NCAIndividual(graph_generator, network_generator, NCA, **ind_config)
individual = NCAIndividual.load_shared_nca("AI/Lunar-test/", "LunarLander-v2_7442_102.3559367978732_1651618879.899823")
#individual = NCAIndividual.load_nca("AI/Lunar/LunarLander-v2_124232_160.233060768647_1650325622.4527128")
#individual.save_nca("AI/a")
#individual.load_nca("LunarLander-v2-NCA-DC")
#for _ in range(100):
score = Fitness.run(evo_config["fitness"]["func"], individual, evo_config["fitness"]["vars"])
print(individual._graph_generator.get_parameters())
print(individual._network_generator.get_parameters())
print(individual.get_config())

#individual.draw_graph(True, False)
print(score)
